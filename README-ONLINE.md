# Pokemon Battle Online - Setup Guide

## Architecture Overview

```
┌─────────────────┐         ┌─────────────────┐
│   Player 1      │         │   Player 2      │
│   (Android)     │◄───────►│   (Android)     │
└────────┬────────┘         └────────┬────────┘
         │                           │
         │      WebSocket            │
         └───────────┬───────────────┘
                     ▼
           ┌─────────────────┐
           │  Node.js Server │
           │  (Socket.io)    │
           └─────────────────┘
```

## What YOU Need To Do

### Prerequisites (Install These First)

1. **Node.js** (v18 or higher)
   - Download: https://nodejs.org/
   - Verify: `node --version`

2. **Android Studio** (for building the APK)
   - Download: https://developer.android.com/studio
   - During install, ensure "Android SDK" is checked
   - After install, open SDK Manager and install:
     - Android SDK Platform 33 (or latest)
     - Android SDK Build-Tools
     - Android Emulator (optional, for testing)

3. **Java JDK 17**
   - Download: https://adoptium.net/
   - Set JAVA_HOME environment variable

---

## Step-by-Step Instructions

### Step 1: Install Dependencies

Open terminal in the `pokemon` folder:

```bash
# Install frontend dependencies (Capacitor)
npm install

# Install server dependencies
cd server
npm install
cd ..
```

### Step 2: Start the Backend Server

The server handles matchmaking and real-time game sync.

**For Local Testing:**
```bash
cd server
npm start
```
Server runs at `http://localhost:3000`

**For Production (so friends can connect):**
You need to deploy the server to a cloud service. Options:
- **Railway.app** (free tier available) - Recommended
- **Render.com** (free tier)
- **Heroku**
- **DigitalOcean**

Quick deploy to Railway:
1. Push `server` folder to a GitHub repo
2. Go to railway.app, connect GitHub
3. Deploy the repo
4. Get your server URL (e.g., `https://your-app.railway.app`)

### Step 3: Update Server URL

Edit `js/network.js` line 7:
```javascript
serverUrl: 'https://YOUR-SERVER-URL.railway.app', // Change this!
```

### Step 4: Build Android App

```bash
# Initialize Capacitor (first time only)
npx cap init "Pokemon Battle" com.pokemonbattle.app --web-dir .

# Add Android platform
npx cap add android

# Sync web files to Android
npx cap sync

# Open in Android Studio
npx cap open android
```

### Step 5: Build APK in Android Studio

1. Android Studio opens automatically
2. Wait for Gradle sync to complete (bottom progress bar)
3. Go to **Build → Build Bundle(s) / APK(s) → Build APK(s)**
4. Wait for build to complete
5. Click "locate" in the notification to find your APK
6. APK location: `android/app/build/outputs/apk/debug/app-debug.apk`

### Step 6: Install on Android Phone

**Option A: USB**
- Enable Developer Options on phone
- Enable USB Debugging
- Connect phone via USB
- In Android Studio: Run → Select your device → Run

**Option B: Transfer APK**
- Copy `app-debug.apk` to phone
- Open file on phone
- Allow "Install from unknown sources" when prompted
- Install

---

## How Online Play Works

1. **Player 1** opens app → taps "PLAY ONLINE" → taps "CREATE ROOM"
2. **Player 1** sees a 6-character room code (e.g., `ABC123`)
3. **Player 1** shares code with friend (text, Discord, etc.)
4. **Player 2** opens app → taps "PLAY ONLINE" → enters code → taps "JOIN"
5. Both players tap "READY"
6. Battle begins! Each player controls their own Pokemon.

---

## Troubleshooting

### "Connection failed"
- Check if server is running
- Check server URL in `js/network.js`
- Ensure phone has internet access
- If using localhost, both devices must be on same WiFi

### "Room not found"
- Room codes expire after 30 minutes
- Code is case-insensitive but must be exact

### Build fails in Android Studio
- File → Sync Project with Gradle Files
- Build → Clean Project, then Build again
- Check you have Android SDK 33+ installed

### App crashes on phone
- Enable USB debugging
- Check logcat in Android Studio for errors
- Ensure all assets are synced: `npx cap sync`

---

## File Structure

```
pokemon/
├── index.html          # Main game UI
├── package.json        # Frontend dependencies
├── capacitor.config.json # Android app config
├── js/
│   ├── game_core.js    # Game state management
│   ├── game_logic.js   # Battle calculations
│   ├── game_render.js  # UI rendering
│   ├── network.js      # Socket.io client
│   └── online_game.js  # Online game controller
├── server/
│   ├── package.json    # Server dependencies
│   └── index.js        # Multiplayer server
└── android/            # (generated by Capacitor)
```

---

## Quick Commands Reference

```bash
# Start local server
cd server && npm start

# Sync changes to Android
npx cap sync

# Open Android Studio
npx cap open android

# Live reload during development
npx cap run android --livereload --external
```

---

## Production Checklist

- [ ] Deploy server to cloud (Railway/Render)
- [ ] Update `serverUrl` in `js/network.js`
- [ ] Test room creation and joining
- [ ] Build release APK (Build → Generate Signed Bundle/APK)
- [ ] Sign APK for Play Store distribution (optional)
